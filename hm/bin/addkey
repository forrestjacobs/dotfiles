#!/usr/bin/env bash

if [[ -z $1 ]]; then
  echo "usage: addkey 'target-host-name'"
  exit 1
fi

host=$(hostname -s)

ssh-keygen -t ed25519 -C "forrest@$host" -f "$HOME"/.ssh/"$1"
mkdir -p /etc/nixos/hosts/"$1"/keys
cp "$HOME"/.ssh/"$1".pub /etc/nixos/hosts/"$1"/keys/"$host".pub
