#!/usr/bin/env bash
mkdir -p "${2}"

# Removes broken links
find -L "${2}" -type l -exec rm -- {} +

# Recreates directory structure
find "${1}" -type d -exec bash -c '
  base_dir="$1"
  path="$2"
  mkdir -p "$base_dir/${path#*/}"
' find-bash "${2}" {} ';'

# Creates softlinks
find "${1}" -type f '!' -name .DS_Store -exec bash -c '
  base_dir="$1"
  path="$2"
  ln -sf "$(pwd)/${path}" "$base_dir/${path#*/}"
' find-bash "${2}" {} ';'
