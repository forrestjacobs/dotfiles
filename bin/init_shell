#!/usr/bin/env bash

shell=$1

# Helpers
escape () {
  text=$1
  text=${text//\\/\\\\}
  text=${text//\'/\\\'}
  echo "'$text'"
}

p_alias () {
  echo "alias $(escape "$1")=$(escape "$2")"
}

p_abbr () {
  if [[ "$shell" = "fish" ]]; then
    echo "abbr $(escape "$1") $(escape "$2")"
  else
    p_alias "$@"
  fi
}

p_export () {
  export "$1"="$2"
  echo "export $(escape "$1")=$(escape "$2")"
}

add_path () {
  p_export PATH "$1:$PATH"
}

# Basic setup
p_export XDG_CONFIG_HOME "$HOME"/.config
add_path "$HOME"/.local/bin

# Homebrew
if command -v /opt/homebrew/bin/brew &> /dev/null; then
  brew_path=/opt/homebrew/bin/brew
elif command -v /home/linuxbrew/.linuxbrew/bin/brew &> /dev/null; then
  brew_path=/home/linuxbrew/.linuxbrew/bin/brew
fi

if [ -n "$brew_path" ]; then
  $brew_path shellenv "$shell"
  eval "$($brew_path shellenv bash)"
fi

# EDITOR
if [[ "$TERM_PROGRAM" == "vscode" ]]; then
  p_export EDITOR code_wait
elif command -v hx &> /dev/null; then
  p_export EDITOR "$(which hx)"
fi

# bat
p_export BAT_STYLE numbers,changes
p_export BAT_THEME ansi

# eza
p_export EZA_ICONS_AUTO
p_export TIME_STYLE iso
if command -v eza &> /dev/null; then
  p_alias ls 'eza'
  p_alias ll 'eza -aagl'
  p_alias lll 'eza -glT --level=2'
else
  p_alias ll 'ls -al'
fi

# less
p_export PAGER less
p_export LESS -iRFXMx4
p_export LESSHISTFILE ~/.cache/less-hist

# man
p_export MANOPT --no-justification

# sudo
p_abbr se 'sudo -e'

# systemctl
if command -v systemctl &> /dev/null; then
  p_abbr S 'sudo systemctl'
fi

# zoxide -- should be toward the end
if command -v zoxide &> /dev/null; then
  zoxide init "$shell" --cmd cd
fi
