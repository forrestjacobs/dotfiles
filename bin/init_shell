#!/usr/bin/env bash

shell=$1

# Helpers
al () {
  if [[ "$shell" = "fish" ]]; then
    echo "alias $1 '$2'"
  else
    echo "alias $1='$2'"
  fi
}

abbr () {
  if [[ "$shell" = "fish" ]]; then
    echo "abbr $1 '$2'"
  else
    al "$@"
  fi
}

set_env () {
  export "$1"="$2"
  if [[ "$shell" = "fish" ]]; then
    echo "set -xg $1 '$2'"
  else
    echo "export $1='$2'"
  fi
}

add_path () {
  set_env PATH "$1:$PATH"
}

p_source () {
  if [[ "$shell" = "fish" ]]; then
    echo "$1 | source"
  else
    echo "eval \$($1)"
  fi
}

# Basic setup
set_env XDG_CONFIG_HOME "$HOME"/.config
add_path "$HOME"/.local/bin

# Homebrew
if command -v /opt/homebrew/bin/brew &> /dev/null; then
  p_source "/opt/homebrew/bin/brew shellenv"
  eval "$(/opt/homebrew/bin/brew shellenv)"
elif command -v /home/linuxbrew/.linuxbrew/bin/brew &> /dev/null; then
  p_source "/home/linuxbrew/.linuxbrew/bin/brew shellenv"
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
fi

# EDITOR
if [[ "$TERM_PROGRAM" == "vscode" ]]; then
  set_env EDITOR code_wait
elif command -v hx &> /dev/null; then
  set_env EDITOR "$(which hx)"
fi

# bat
set_env BAT_STYLE numbers,changes
set_env BAT_THEME ansi

# eza
set_env EZA_ICONS_AUTO
set_env TIME_STYLE iso
if command -v eza &> /dev/null; then
  al ls 'eza'
  al ll 'eza -aagl'
  al lll 'eza -glT --level=2'
else
  al ll 'ls -al'
fi

# less
set_env PAGER less
set_env LESS -iRFXMx4
set_env LESSHISTFILE ~/.cache/less-hist

# man
set_env MANOPT --no-justification

# sudo
abbr se 'sudo -e'

# systemctl
if command -v systemctl &> /dev/null; then
  abbr S 'sudo systemctl'
fi

# zoxide -- should be toward the end
if command -v zoxide &> /dev/null; then
  p_source "zoxide init $shell --cmd cd"
fi
